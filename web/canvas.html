<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI 科研绘图 - 编辑器</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body data-page="canvas">
    <div class="canvas-page">
      <header class="topbar">
        <div>
          <div class="brand">
            <a href="/" class="back-link" title="返回首页">&larr;</a>
            AI 科研绘图 - 编辑器
          </div>
          <div class="subtitle">
            状态：<span id="statusText">等待中</span>
          </div>
        </div>
        <div class="topbar-actions">
          <button class="ghost danger-ghost" id="cancelBtn" style="display:none">取消任务</button>
          <button class="ghost" id="logToggle">日志</button>
          <div class="job-pill">任务 <span id="jobId"></span></div>
        </div>
      </header>

      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
        <div class="progress-steps" id="progressSteps">
          <span class="progress-step active" data-step="0">等待</span>
          <span class="progress-step" data-step="1">生成图片</span>
          <span class="progress-step" data-step="2">SAM3 分割</span>
          <span class="progress-step" data-step="3">提取图标</span>
          <span class="progress-step" data-step="4">生成模板</span>
          <span class="progress-step" data-step="5">最终合成</span>
        </div>
      </div>

      <main class="canvas-stage">
        <div class="canvas-shell">
          <iframe
            id="svgEditorFrame"
            class="svg-frame"
            title="SVG 编辑画布"
          ></iframe>
          <div id="svgFallback" class="svg-fallback">
            <div class="fallback-title">SVG 编辑器未安装</div>
            <div class="fallback-body">
              请将 SVG-Edit 构建文件放入 <code>web/vendor/svg-edit/</code>（需包含 editor/index.html）以启用编辑功能。
            </div>
            <object id="fallbackObject" type="image/svg+xml" class="fallback-object"></object>
          </div>
          <div id="previewOverlay" class="preview-overlay">
            <div class="preview-spinner"></div>
            <div class="preview-step-label" id="previewStepLabel">正在生成图片...</div>
            <img id="previewImage" class="preview-image" alt="中间产物预览" />
          </div>
        </div>
      </main>

      <button class="fab" id="artifactToggle" aria-label="产物面板">
        <svg class="fab-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path
            d="M4 5h16a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm1 2v10h14V7H5zm2 8l3-3 2 2 3-3 4 4H7z"
            fill="#f2f2f2"
          />
        </svg>
      </button>

      <aside class="artifact-panel" id="artifactPanel">
        <div class="panel-header">产物</div>
        <div class="artifact-list" id="artifactList"></div>
      </aside>

      <aside class="log-panel" id="logPanel">
        <div class="panel-header">日志</div>
        <div class="log-body" id="logBody"></div>
      </aside>
    </div>

    <script src="/app.js"></script>
  </body>
</html>
